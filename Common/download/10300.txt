using Common_Robot2;
using Downloader;
using System.ComponentModel;
using System.Net;

namespace Test1
{
    public class W_Download : C_Node
    {
        public string key_step = "";//下载服务器
        public string url = "";//要下载的文件的url
        public string file = "";//保存到本地的路径
        
        public W_Download(string Name, C_Space space_parent, C_Space space) :
            base(space_parent, space)
        {
            this.Name = Name;
            space.vars_step.Add(Name, this);
        }

        public override Task run_sub()
        {
            run_sub_main();
            return Task.CompletedTask;
        }

        public void run_sub_main()
        {
            string str_url = this.read_string(this.url);
            string str_file = this.read_string(this.file);

            W_Download_Service service = (W_Download_Service)space.vars.vars_step[this.key_step];
            service.downloader.DownloadFileTaskAsync(str_url, str_file);
        }



        public void init()
        {
            //service.pEvent += Service_pEvent;
        }

         
        private void OnDownloadStarted(object sender, DownloadStartedEventArgs e)
        {
            Main.WriteLine(this,"开始下载!");
        }


        private void OnDownloadFileCompleted(object sender, AsyncCompletedEventArgs e)
        {
            Main.WriteLine(this, "下载完毕!");
            
        }

        private void OnDownloadProgressChanged(object sender, Downloader.DownloadProgressChangedEventArgs e)
        {
            Main.WriteLine(this, "进度=" + e.ProgressPercentage);
        }

    }
}
