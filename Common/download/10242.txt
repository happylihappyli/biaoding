using Common_Robot;
using Common_Robot2;

namespace Test1
{
    public class D_Byte_To_Image : C_Node
    {
        public string key_read = "2d_pic";
        public string key_save = "";
        public string key_width = "0";
        public string key_height = "0";

        public D_Byte_To_Image(string name, C_Space space_parent, C_Space space) :
            base(space_parent, space)
        {
            this.Name = name;
            space.vars_step.Add(Name, this);
        }

        public void init()
        {

        }

        public override Task run_sub()
        {
            run_sub_main();
            return Task.CompletedTask;
        }


        public void run_sub_main()
        {
            byte[] buffer = (byte[])this.read_var(this.key_read, "byte[]");

            double d_w = Main.get_double_from_obj(this, this.read_var(this.key_width, "double"));
            double d_h = Main.get_double_from_obj(this, this.read_var(this.key_height, "double"));

            int i_w = (int)d_w;
            int i_h = (int)d_h;

            Bitmap bmp = Main.convert_byte_to_bmp(buffer, i_w, i_h);

            this.save_var(this.key_save, "Bitmap", bmp);


        }

    }
}