using Common_Robot2;
using ConverxHull;
using System.Collections;

using pcammls;
using System.Collections.Generic;


namespace Test1
{
    /// <summary>
    /// 历史相机，测试用模块
    /// </summary>
    public class S_Camera_History : C_Node
    {
        public string path = "";
        public string key_cloud = "";
        public string key_pic = "";
        public S_Camera_History(string name, C_Space space_parent, C_Space space) : base(name,space_parent, space)
        {

        }

        public override void init()
        {

        }


        public override Task run_sub()
        {
            run_sub_main(); 
            return Task.CompletedTask;
        }


        int index = 0;
        List<string> list = new List<string>();
        public void read_list()
        {
            if (list.Count == 0)
            {
                string str_path = this.read_string(path);

                foreach (string line in File.ReadLines(str_path+"\\history.txt"))
                {
                    list.Add(line);
                }
            }
        }

        public void run_sub_main()
        {
            string str_path = this.read_string(path);
            Main.WriteLine(this,"-------------读取历史相机记录");

            read_list();

            new Task(() =>
            {
                Console.Beep(3000, 200);
            }).Start();

            string id = list[index];
            index++;
            if (index >= list.Count) index = 0;

            string file_cloud = str_path + "\\" + id + ".cloud";
            string file_pic = str_path + "\\" + id + ".png";

            List<C_Point3D> cloud1 = Main.cloud_read(this, file_cloud, ",");
            this.save_var(key_cloud, "List<C_Point3D>", cloud1);

            Bitmap bmp = new Bitmap(file_pic);
            this.save_var(key_pic, "Bitmap", bmp);
        }


    }
}
