using Common_Robot2;
using Newtonsoft.Json.Linq;
using ConverxHull;
using System.Collections.Generic;

namespace Test1
{
    public class String_To_Cloud : C_Node
    {
        public string str = "";
        public string key_save = "";

        public String_To_Cloud(string name, C_Space space_parent, C_Space space) : base(name,space_parent, space)
        {
            this.Name = name;
            //space.vars_step.Add(name, this);
        }


        public override Task run_sub()
        {
            run_sub_main();
            return Task.CompletedTask;
        }

        public void run_sub_main()
        {
            string[] strSplit=this.key_save.Split(',');
            string strLine = this.read_string(this.str);

            JArray arr = JArray.Parse(strLine);

            List<C_Point3D> list = new List<C_Point3D>();
            for (var i = 0; i < arr.Count; i++)
            {
                JObject item = (JObject)arr[i];
                {
                    {
                        //JArray item = (JArray)line[i];
                        string strX = item["x"].ToString();
                        string strY = item["y"].ToString(); //(string?)item[1];
                        if (strX==null || strY == null)
                        {
                            continue;
                        }
                        float x = float.Parse(strX);
                        float y = float.Parse(strY);// (string)item[1]);
                        C_Point3D pPoint = new C_Point3D(x, y, 0);
                        list.Add(pPoint);
                    }
                }
            }

            this.save_var(key_save, "List<C_Point3D>", list);

        }


        public override void init()
        {
            
        }
    }
}
