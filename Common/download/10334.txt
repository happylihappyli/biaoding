using Common_Robot;
using Common_Robot2;


namespace Test1
{
    public class String_Replace : C_Node
    {
        public string template = "";
        public string find = "";
        public string replace = "";
        public string key_save = "";

        public string data_in = "";
        public string data_out = "";


        public String_Replace(string Name,C_Space space_parent, C_Space space) : 
            base(space_parent,space)
        {
            this.Name = Name;
            space.vars_step.Add(Name, this);
        }

        public override Task run_sub()
        {

            run_sub_main();
            return Task.CompletedTask;
        }

        private void run_sub_main()
        {
            if (this.data_in != "")
            {
                this.template = "@" + this.data_in;
            }
            if (this.data_out != "")
            {
                key_save =this.data_out;
            }


            var value_all = space.tools.var_read(pTrain, this, this.template);
            var find = (string)space.tools.var_read(pTrain, this, this.find);
            var replace = (string)space.tools.var_read(pTrain, this, this.replace);

            if (value_all != null && find!=null)
            {
                if (find == "*\\r") find = "\r";
                if (find == "*\\n") find = "\n";
                find = find.Replace("*\\u001b", "\u001b");

                value_all = value_all.Replace(find, replace);
                space.vars.save_vars(pTrain, this, key_save, "string", value_all);
            }
            else
            {
                space.vars.save_vars(pTrain, this, key_save, "string", "find==null @"+this.Name);
            }
        }
    }
}
